{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Admin allowlist signup + client service-selection onboarding (Internet Identity only, no OTP)",
  "requirements": [
    {
      "id": "REQ-24",
      "summary": "Keep Internet Identity as the only authentication method and ensure sign-in UI does not imply OTP; identifier is only for context/prefill.",
      "acceptanceCriteria": [
        "There is no UI, API, or backend logic that attempts to send or verify OTP codes.",
        "Sign-in continues to use the existing Internet Identity login flow, with the identifier only used for prefill/onboarding context.",
        "User-facing copy on the sign-in page remains in English and does not claim OTP delivery."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/SignInPage.tsx",
          "operation": "modify",
          "description": "Update English UI copy to explicitly state that authentication continues via Internet Identity after entering an email/phone identifier, and ensure no wording suggests OTP delivery or verification."
        },
        {
          "path": "frontend/src/utils/signInIdentifier.ts",
          "operation": "modify",
          "description": "Add small helper(s) for normalizing/comparing identifiers (e.g., case-insensitive email compare and phone normalization) so the identifier remains a context value only and is safe to reuse for prefills."
        }
      ]
    },
    {
      "id": "REQ-25",
      "summary": "Implement admin-only first-time profile setup allowlist behavior (prefill/lock Admin for allowlisted identifier; prevent Admin selection otherwise).",
      "acceptanceCriteria": [
        "When the stored identifier equals \"+919182768591\" or \"quickbeeagency@gmail.com\" (case-insensitive for email), the profile setup modal prefills name/email/phone accordingly and the role is locked to Admin.",
        "When the stored identifier does not match the allowlist, the profile setup modal does not allow choosing Admin (role is effectively Team/User-only).",
        "All user-facing text related to this flow is in English."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/adminAllowlist.ts",
          "operation": "create",
          "description": "Create a small allowlist utility that contains the allowlisted admin identity details and exposes functions to check whether a stored identifier matches (email case-insensitive; phone normalized)."
        },
        {
          "path": "frontend/src/components/auth/ProfileSetupModal.tsx",
          "operation": "modify",
          "description": "Use the authorization component's profile setup approach (getCallerUserProfile/registerUser pattern) to enforce allowlist UI rules: when identifier matches allowlist, prefill name/email/phone and lock role to Admin (not editable); otherwise, default to non-admin role and remove/disable the Admin option. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-27",
      "summary": "Add a client onboarding flow for non-admin users to browse services, review details/cost, submit a client service request, and view their submitted requests in-app.",
      "acceptanceCriteria": [
        "After a non-admin user completes profile setup (or on next app entry if already registered), they can access a client onboarding screen to select a service.",
        "The client onboarding UI shows service details and cost details for the selected service before submission.",
        "Submitting creates a stored record in the backend that includes at least: client principal, agency, selected service identifier, captured cost/price details shown/accepted, and a timestamp.",
        "Clients can see their submitted requests in-app (e.g., a “My Requests” list in the onboarding screen)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useClientServiceRequests.ts",
          "operation": "create",
          "description": "Add React Query hooks to (1) create a client service request and (2) fetch requests for the current agency; client UI can filter by current principal to render a 'My Requests' list. Handle authorization failures gracefully per the authorization component guidance. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/ClientOnboardingPage.tsx",
          "operation": "create",
          "description": "Create a client onboarding page that loads available services, lets the user select a service, displays service details and price/cost details before submission, submits a request, and renders a 'My Requests' list for the signed-in principal (filtering agency requests by principal string). Use the authorization component guidance for authenticated data access and error handling. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Wire the new client onboarding page into routing (add a route such as '/onboarding') so it is navigable after sign-in/profile setup."
        },
        {
          "path": "frontend/src/components/nav/SidebarNav.tsx",
          "operation": "modify",
          "description": "Add a navigation entry to the client onboarding screen for non-admin users only (hide from Admin) using role information from the authorization flow. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-28",
      "summary": "Provide an admin-only in-app view to review client service requests with client identifier, selected service, cost details, and submission time.",
      "acceptanceCriteria": [
        "Admin users can access a page/section that lists client service requests for their agency.",
        "Non-admin users cannot access this admin review UI (route/section hidden and guarded).",
        "The list displays, per request: client identifier, service, cost details, and submission time."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/admin/AdminOnlySection.tsx",
          "operation": "create",
          "description": "Create a small wrapper component that uses role/admin status checks to guard admin-only UI; show an English access-denied message when unauthorized, following the authorization component's access-control UI guidance. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/admin/ClientServiceRequestsAdminPanel.tsx",
          "operation": "create",
          "description": "Implement an admin panel component that fetches agency client service requests, joins display data with service info (as needed), and renders a list showing client identifier (principal and any available submitted email/phone if present in request details), selected service, captured cost details, and submission time. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/SettingsPage.tsx",
          "operation": "modify",
          "description": "Add an Admin-only section within Settings that renders the ClientServiceRequestsAdminPanel under an AdminOnlySection guard; keep all user-facing copy in English and ensure non-admins cannot view the content."
        },
        {
          "path": "frontend/src/components/nav/SidebarNav.tsx",
          "operation": "modify",
          "description": "Ensure the admin review UI is not presented to non-admin users in navigation (if any link/label is added for admin review, keep it hidden for non-admins) using the authorization component's role-based access approach. Verify the component's usage instructions before implementing."
        }
      ]
    }
  ]
}